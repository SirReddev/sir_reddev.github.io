<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Chatbox Generator (English)</title>
<style type="text/css">
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #1a1a1a; color: #fff; padding: 20px; display: flex; justify-content: center; }
    .container { width: 100%; max-width: 850px; background: #252525; padding: 30px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); border: 1px solid #333; }
    h2 { margin-top: 0; color: #3a64ff; font-weight: 300; letter-spacing: 1px; }
    #cbin, #cbout {
        width: 100%;
        height: 220px;
        background: #0f0f0f;
        color: #e0e0e0;
        border: 1px solid #444;
        padding: 15px;
        font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        box-sizing: border-box;
        border-radius: 6px;
        resize: vertical;
        font-size: 14px;
        line-height: 1.5;
    }
    #cbout { color: #00d4ff; background: #0a0a0a; border-color: #222; }
    button {
        padding: 14px 28px;
        background: #3a64ff;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        margin: 20px 0;
        font-weight: bold;
        font-size: 1rem;
        transition: background 0.2s;
    }
    button:hover { background: #5579ff; }
    .hint { background: #2d2d2d; padding: 15px; border-radius: 6px; margin-bottom: 20px; border-left: 5px solid #3a64ff; font-size: 0.9em; color: #ccc; }
    code { background: #000; padding: 2px 5px; border-radius: 4px; color: #ff94d1; font-family: monospace; }
</style>
</head>
<body>

<div class="container">
    <h2>Chatbox Function Generator</h2>
    
    <div class="hint">
        <b>Quick Tips:</b><br>
        • <b>New Page:</b> Hit <code>Enter</code> to create a page break (Next:1b).<br>
        • <b>Colors:</b> <code>%c=FF3A3A%</code> applies to everything until the next color tag.<br>
        • <b>Bold:</b> <code>%b=true%</code> to turn on, <code>%b=false%</code> to turn off.<br>
        • <b>Delay:</b> <code>%s=10%</code> adds a pause before the next character appears.<br>
    </div>

    <form name="form" id="form">
        <label style="display:block; margin-bottom: 8px; color: #888;">Input Text:</label>
        <textarea id="cbin" placeholder="Example: %c=FF3A3A%Red is destruction.\n%c=3A64FF%Blue is indifference.">%c=FF3A3A%Red is destruction.
%c=3A64FF,s=20%Blue is indifference.
%c=FFFFFF,b=true%Bold White!</textarea>
        
        <button type="button" onclick="document.getElementById('cbout').value = ChatboxCommandOutput(document.getElementById('cbin').value)">
            Generate Minecraft Command
        </button>
        
        <label style="display:block; margin-bottom: 8px; color: #888;">Output Command:</label>
        <textarea id="cbout" readonly placeholder="The Minecraft command will appear here..."></textarea>
    </form>
</div>

<script>
    // Character Width Database
    var six = ["~"];
    var five = ["f","k","“","”"];
    var four = ["I","t","\""," ","(",")","[","]"];
    var three = ["l"];
    var two = ["i",".",",","\"",":","!"];

    var boldflag = 0;

    function GetLen(c) {
        var out = 9;
        if(c.charCodeAt() < 128) {
            if(Ifin(c,six)) out = 6;
            else if(Ifin(c,five)) out = 5;
            else if(Ifin(c,four)) out = 4;
            else if(Ifin(c,three)) out = 3;
            else if(Ifin(c,two)) out = 2;
            else out = 6;
            out += boldflag;
        }
        return out;    
    }

    function Ifin(x, y) {
        for(var i = 0; i < y.length; i++) if(x == y[i]) return true;
        return false;
    }

    function ChatboxCommandOutput(input) {
        boldflag = 0;
        var out = "function chatbox:bossbar/clear/with_all\ndata modify storage chatbox:main Buffer set value [";
        var chs = input.split("");
        var elements = [];

        // Formatting state trackers
        var activeColor = null;
        var activeBold = null;
        var pendingDelay = null;

        for(var i = 0; i < chs.length; i++) {
            if(chs[i] == "\r") continue;
            
            if(chs[i] == "\n") {
                elements.push("{Next:1b}");
            } 
            else if(chs[i] == "%") {
                // Parse the formatting tag
                let tagContent = "";
                i++; // skip opening %
                while(i < chs.length && chs[i] != "%") {
                    tagContent += chs[i];
                    i++;
                }
                // i is now at closing %

                let params = tagContent.split(",");
                params.forEach(param => {
                    let parts = param.split("=");
                    let key = parts[0].trim();
                    let val = parts[1] ? parts[1].trim() : "";

                    if(key === "c") activeColor = val.toUpperCase();
                    if(key === "b") {
                        activeBold = (val === "true");
                        boldflag = activeBold ? 2 : 0;
                    }
                    if(key === "s") pendingDelay = val;
                });
                // Note: We don't create an element yet. 
                // The formatting applies to the next actual text character.
            } 
            else {
                // Process a text character
                let charVal = chs[i] == "\"" ? "\\\"" : chs[i];
                let charLen = GetLen(chs[i]);
                
                // Start Object
                let nbt = `{Char:"${charVal}",Length:${charLen}`;

                // Apply persistent Delay (one-time use)
                if(pendingDelay) {
                    nbt += `,Delay:${pendingDelay}`;
                    pendingDelay = null;
                }

                // Apply persistent Format (Color/Bold)
                if(activeColor || activeBold !== null) {
                    nbt += `,Format:{text:\\"\\"`;
                    if(activeColor) nbt += `,color:\\"#${activeColor}\\"`;
                    if(activeBold !== null) nbt += `,bold:${activeBold ? 'true' : 'false'}`;
                    nbt += `}`;
                }

                nbt += `}`;
                elements.push(nbt);
            }
        }
        
        out += elements.join(",") + "]\nscoreboard players set #chatbox.text.timer loy.value 0";
        return out;
    }
</script>

</body>
</html>