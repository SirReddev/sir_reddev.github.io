<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Chatbox Generator (English)</title>
<style type="text/css">
    body { font-family: sans-serif; background: #222; color: #fff; padding: 20px; }
    #cbin, #cbout {
        width: 100%;
        max-width: 600px;
        height: 200px;
        background: #333;
        color: #fff;
        border: 1px solid #555;
        padding: 10px;
        font-family: monospace;
    }
    button {
        padding: 10px 20px;
        background: #3a64ff;
        color: white;
        border: none;
        cursor: pointer;
        margin: 10px 0;
    }
    button:hover { background: #5579ff; }
    .hint { color: #bbb; font-size: 0.9em; }
</style>
</head>
<body>

<h2>Chatbox Generator</h2>
<div class="hint">
    <b>Instructions:</b><br>
    • New Line: Use Enter to trigger <code>{Next:1b}</code><br>
    • Colors: <code>%c=FF5555%</code> (HEX code)<br>
    • Delays: <code>%s=20%</code> (Pause in game ticks)<br>
    • Bold: <code>%b=true%</code> or <code>%b=false%</code><br>
    • Combined: <code>%c=FFAAAA,s=10,b=true%</code>
</div>

<form name="form" id="form">
<textarea id="cbin">
%c=FF3A3A%Red is destruction.
%c=3A64FF,s=20%Blue is indifference.
%c=FFFFFF,b=true%Bold White!
</textarea>
<br>
<button type="button" onclick="document.getElementById('cbout').value = ChatboxCommandOutput(document.getElementById('cbin').value)">
    Generate Command
</button>
<br>
<textarea id="cbout" readonly placeholder="Command will appear here..."></textarea>
</form>

<script>
    var six = ["~"];
    var five = ["f","k","“","”"];
    var four = ["I","t","\""," ","(",")","[","]"];
    var three = ["l"];
    var two = ["i",".",",","\"",":","!"];

    var boldflag = 0;

    function GetLen(c) {
        var out = 9;
        if(c.charCodeAt() < 128) {
            if(Ifin(c,six)) out = 6;
            else if(Ifin(c,five)) out = 5;
            else if(Ifin(c,four)) out = 4;
            else if(Ifin(c,three)) out = 3;
            else if(Ifin(c,two)) out = 2;
            else out = 6;
            out += boldflag;
        }
        return out;    
    }

    function Ifin(x, y) {
        for(var i = 0; i < y.length; i++) if(x == y[i]) return true;
        return false;
    }

    function Attribute(c, i) {
        var out = "";
        var start = i;
        var tagContent = "";
        
        while(i < c.length && c[i] != "%") {
            tagContent += c[i];
            i++;
        }

        var params = tagContent.split(",");
        params.forEach(param => {
            if(param.startsWith("b=")) {
                let val = param.split("=")[1];
                boldflag = (val === "true") ? 2 : -1;
            }
            if(param.startsWith("s=")) {
                let val = param.split("=")[1];
                out += (out ? "," : "") + "Delay:" + val;
            }
            if(param.startsWith("c=")) {
                let val = param.split("=")[1].toUpperCase();
                let format = `{"text":"","color":"#${val}"`;
                if(boldflag == 2) { format += `,"bold":true`; boldflag = 1; }
                else if(boldflag == -1) { format += `,"bold":false`; boldflag = 0; }
                format += `}`;
                out += (out ? "," : "") + "Format:'" + format + "'";
            }
        });

        if(boldflag == 2) { out += (out ? "," : "") + "Format:'{\"text\":\"\",\"bold\":true}'"; boldflag = 1; }
        else if(boldflag == -1) { out += (out ? "," : "") + "Format:'{\"text\":\"\",\"bold\":false}'"; boldflag = 0; }
        
        return out;
    }

    function ChatboxCommandOutput(input) {
        boldflag = 0;
        var out = "function chatbox:bossbar/clear/with_all\ndata modify storage chatbox:main Buffer set value [";
        var chs = input.split("");
        var elements = [];

        for(var i = 0; i < chs.length; i++) {
            if(chs[i] == "\r") continue;
            if(chs[i] == "\n") {
                elements.push("{Next:1b}");
            } else if(chs[i] == "%") {
                var extra = Attribute(chs, i + 1);
                while(i < chs.length && chs[i+1] != "%") i++;
                i += 2; // skip the closing %
                if(i < chs.length) {
                    var charVal = chs[i] == "\"" ? "\\\"" : chs[i];
                    elements.push(`{Char:"${charVal}",Length:${GetLen(chs[i])}${extra ? "," + extra : ""}}`);
                }
            } else {
                var charVal = chs[i] == "\"" ? "\\\"" : chs[i];
                elements.push(`{Char:"${charVal}",Length:${GetLen(chs[i])}}`);
            }
        }
        
        out += elements.join(",") + "]\nscoreboard players set #chatbox.text.timer loy.value 0";
        return out;
    }
</script>
</body>
</html>
