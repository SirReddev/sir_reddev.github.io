<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Chatbox Generator</title>
<style type="text/css">
    body { font-family: 'Segoe UI', sans-serif; background: #1a1a1a; color: #fff; padding: 20px; display: flex; justify-content: center; }
    .container { width: 100%; max-width: 850px; background: #252525; padding: 30px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); border: 1px solid #333; }
    h2 { margin-top: 0; color: #3a64ff; font-weight: 300; }
    #cbin, #cbout {
        width: 100%;
        height: 220px;
        background: #0f0f0f;
        color: #e0e0e0;
        border: 1px solid #444;
        padding: 15px;
        font-family: 'Consolas', monospace;
        box-sizing: border-box;
        border-radius: 6px;
        resize: vertical;
        font-size: 14px;
    }
    #cbout { color: #00d4ff; background: #0a0a0a; }
    .btn-group { display: flex; gap: 10px; margin: 20px 0; }
    button {
        padding: 12px 24px;
        background: #3a64ff;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: bold;
        transition: 0.2s;
    }
    button:hover { background: #5579ff; }
    .copy-btn { background: #28a745; }
    .copy-btn:hover { background: #218838; }
    .hint { background: #2d2d2d; padding: 15px; border-radius: 6px; margin-bottom: 20px; border-left: 5px solid #3a64ff; font-size: 0.9em; color: #ccc; }
    code { color: #ff94d1; font-family: monospace; }
</style>
</head>
<body>

<div class="container">
    <h2>Chatbox Function Generator</h2>
    
    <div class="hint">
        <b>Formatting:</b><br>
        • <code>%c=FF3A3A%</code> Color | <code>%b=true%</code> Bold | <code>%s=10%</code> Delay | <code>Enter</code> New Page
    </div>

    <textarea id="cbin" placeholder="Input text here...">%c=FF3A3A%Red is destruction.
%c=3A64FF,s=20%Blue is indifference.</textarea>
    
    <div class="btn-group">
        <button type="button" onclick="generate()">Generate Command</button>
        <button type="button" class="copy-btn" onclick="copyToClipboard()">Copy to Clipboard</button>
    </div>
    
    <textarea id="cbout" readonly placeholder="Output will appear here..."></textarea>
</div>

<script>
    var six = ["~"], five = ["f","k","“","”"], four = ["I","t","\""," ","(",")","[","]"], three = ["l"], two = ["i",".",",","\"",":","!"];
    var boldflag = 0;

    function Ifin(x, y) { for(var i = 0; i < y.length; i++) if(x == y[i]) return true; return false; }

    function GetLen(c) {
        var out = 9;
        if(c.charCodeAt() < 128) {
            if(Ifin(c,six)) out = 6;
            else if(Ifin(c,five)) out = 5;
            else if(Ifin(c,four)) out = 4;
            else if(Ifin(c,three)) out = 3;
            else if(Ifin(c,two)) out = 2;
            else out = 6;
            out += boldflag;
        }
        return out;    
    }

    function generate() {
        var input = document.getElementById('cbin').value;
        var chs = input.split("");
        var elements = [];
        
        // Persistent States
        var activeColor = null;
        var activeBold = null;
        var pendingDelay = null;
        boldflag = 0;

        for(var i = 0; i < chs.length; i++) {
            if(chs[i] == "\r") continue;
            
            if(chs[i] == "\n") {
                elements.push("{Next:1b}");
            } 
            else if(chs[i] == "%") {
                let tag = ""; i++;
                while(i < chs.length && chs[i] != "%") { tag += chs[i]; i++; }
                
                tag.split(",").forEach(p => {
                    let [k, v] = p.split("=");
                    if(!k || !v) return;
                    k = k.trim(); v = v.trim();

                    if(k === "c") activeColor = v.toUpperCase();
                    if(k === "b") {
                        activeBold = (v === "true");
                        boldflag = activeBold ? 2 : 0;
                    }
                    if(k === "s") pendingDelay = v;
                });
            } 
            else {
                let charVal = chs[i] == "\"" ? "\\\"" : chs[i];
                let nbt = `{Char:"${charVal}",Length:${GetLen(chs[i])}`;
                
                if(pendingDelay) {
                    nbt += `,Delay:${pendingDelay}`;
                    pendingDelay = null;
                }

                if(activeColor || activeBold !== null) {
                    // EXACT MATCH for your requirement: Format:{"text":"","color":"#HEX"}
                    let formatParts = ['"text":""'];
                    if(activeColor) formatParts.push(`"color":"#${activeColor}"`);
                    if(activeBold !== null) formatParts.push(`"bold":${activeBold}`);
                    
                    nbt += `,Format:{${formatParts.join(",")}}`;
                }

                nbt += `}`;
                elements.push(nbt);
            }
        }
        
        let finalCommand = `function chatbox:bossbar/clear/with_all\ndata modify storage chatbox:main Buffer set value [${elements.join(",")}]\nscoreboard players set #chatbox.text.timer loy.value 0`;
        document.getElementById('cbout').value = finalCommand;
    }

    function copyToClipboard() {
        var copyText = document.getElementById("cbout");
        copyText.select();
        document.execCommand("copy");
    }
</script>
</body>
</html>